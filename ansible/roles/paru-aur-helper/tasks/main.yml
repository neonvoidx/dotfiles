---
# Role: paru-aur-helper
# Description: Install paru AUR helper for managing AUR packages
# Paru is a modern AUR helper written in Rust

- name: Check if paru is already installed
  command: which paru
  register: paru_installed
  changed_when: false
  failed_when: false
  tags: ['paru', 'aur']

- name: Ensure base-devel is installed (required for building AUR packages)
  community.general.pacman:
    name: base-devel
    state: present
  when: paru_installed.rc != 0
  tags: ['paru', 'aur']

- name: Ensure git is installed (required for cloning paru)
  community.general.pacman:
    name: git
    state: present
  when: paru_installed.rc != 0
  tags: ['paru', 'aur']

- name: Clone paru repository
  become: no
  git:
    repo: https://aur.archlinux.org/paru.git
    dest: /tmp/paru
    update: yes
  when: paru_installed.rc != 0
  tags: ['paru', 'aur']

- name: Build and install paru
  become: no
  command: makepkg -si --noconfirm
  args:
    chdir: /tmp/paru
  when: paru_installed.rc != 0
  tags: ['paru', 'aur']

- name: Clean up paru build directory
  file:
    path: /tmp/paru
    state: absent
  when: paru_installed.rc != 0
  tags: ['paru', 'aur', 'cleanup']

# Optional: Configure paru settings
# - name: Configure paru
#   template:
#     src: paru.conf.j2
#     dest: /etc/paru.conf
#     mode: '0644'
#   tags: ['paru', 'config']
